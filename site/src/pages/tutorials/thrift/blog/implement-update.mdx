---
menuTitle: "Implement UPDATE"
order: 5
category: thrift
tags:
  - server
level: basic
type: step
---

# Implementing UPDATE operation

Previously, we created and read blog posts. Now, let's implement and make a call to update a blog post.

<TutorialSteps current={5} />

## What you need

You need to have the files obtained from previous steps:

- [Java code generated](/tutorials/thrift/blog/define-service#compile-the-thrift-file)
- blog.thrift(both server and client)
- Main.java
- BlogServiceImpl.java
- BlogClient.java
- BlogServiceExceptionHandler.java

## 1. Implement server-side

1. Add a service method and a struct in the `blog.thrift` file.
  ```thrift filename=blog.thrift
  /**
   * A request object for updating a blog post.
   */
  struct UpdateBlogPostRequest {
      1: i32 id;
      2: string title;
      3: string content;
  }

  /**
   * My first BlogService in Armeria!
   */
  service BlogService {
  ...
    /**
     * Updates a blog post.
     */
    BlogPost updateBlogPost(1:UpdateBlogPostRequest request) throws (1:BlogNotFoundException e),
  }
  ```
2. [Compile the thrift file](/tutorials/thrift/blog/create-service#2-compile-the-thrift-file) to generate Java code.
3. In the `BlogServiceImpl` class, add a service method for updating a blog post.
  Let's throw an exception in case there is no blog post for the given ID.
  ```java filename=BlogServiceImpl.java
  import example.armeria.blog.thrift.UpdateBlogPostRequest;

  public class BlogServiceImpl implements BlogService.AsyncIface {
    ...
    @Override
    public void updateBlogPost(UpdateBlogPostRequest request, AsyncMethodCallback<BlogPost> resultHandler)
            throws TException {
        final BlogPost oldBlogPost = blogPosts.get(request.getId());
        if (oldBlogPost == null) {
            resultHandler.onError(
                    new BlogNotFoundException("The blog post does not exist. ID: " + request.getId()));
        } else {
            final BlogPost newBlogPost = oldBlogPost.deepCopy()
                                                    .setTitle(request.getTitle())
                                                    .setContent(request.getContent())
                                                    .setModifiedAt(Instant.now().toEpochMilli());
            blogPosts.put(request.getId(), newBlogPost);
            resultHandler.onComplete(newBlogPost);
        }
    }
  }
  ```

## 2. Implement client-side

1. Add a service method and a struct for updating a blog post in `blog.thrift` file, as we did in [1. Implement server-side](#1-implement-server-side).
2. [Compile the thrift file](/tutorials/thrift/blog/create-service#2-compile-the-thrift-file) to generate Java code.
2. Add a method `updateBlogPost()` to send a request to update a blog post.
  ```java filename=BlogClient.java
  import example.armeria.blog.thrift.UpdateBlogPostRequest;

  public class BlogClient {
    ...
    void updateBlogPost(int id, String newTitle, String newContent) throws Exception {
        final UpdateBlogPostRequest request = new UpdateBlogPostRequest().setId(id).setTitle(newTitle).setContent(newContent);
        blogService.updateBlogPost(request);
    }
  }
  ```

## 3. Test updating a blog post

Let's test updating a blog post.
Since we are giving an incremental ID to blog posts, we'll update the post with ID `1`.

1. In the `testRun()` method, call the `updateBlogPost()` method to test run the update method we just implemented.
  ```java filename=BlogClient.java
    void testRun() throws Exception {
        createBlogPost("My first blog", "Yay");
        createBlogPost("Another blog post", "Creating a post via createBlogPost().");
        getBlogPost(1);
        updateBlogPost(1, "New title", "New content.");
        getBlogPost(1);
    }
  ```
2. [Re-run the server](/tutorials/thrift/blog/create-server#7-test-run) and run the client.
3. Let's dig into the logs to see if it worked as expected.
  Search for `method=getBlogPost` in the log, check that you see logs for the get request followed by the response.
  The blog post has an ID `1` with a title `Another blog post` before updating.
  ```bash
  [armeria-common-worker-nio-2-2] DEBUG c.l.a.c.logging.LoggingRpcClient - ... { ... ,  content=DefaultRpcRequest{
    serviceType=BlogService$Iface, 
    serviceName=example.armeria.blog.thrift.BlogService$Iface, 
    method=getBlogPost, params=[GetBlogPostRequest(id:1)]}}
  ...
  [armeria-common-worker-nio-2-2] DEBUG c.l.a.c.logging.LoggingRpcClient - ... { ... , content=CompletableRpcResponse{
  BlogPost(
    id:1, 
    title:Another blog post, 
    content:Creating a post via createBlogPost()., 
    createdAt:1677140636921, 
    modifiedAt:1677140636921)}}
  ```
4. This time, search for `method=updateBlogPost` in the subsequent logs.
  Check that you see logs for the update request and the response.
   ```bash
  [armeria-common-worker-nio-2-2] DEBUG c.l.a.c.logging.LoggingRpcClient - ... { ... , content=DefaultRpcRequest{
    serviceType=BlogService$Iface, 
    serviceName=example.armeria.blog.thrift.BlogService$Iface, 
    method=updateBlogPost, 
    params=[UpdateBlogPostRequest(
      id:1, 
      title:New title, 
      content:New content.)]}}
   ...
   [armeria-common-worker-nio-2-2] DEBUG c.l.a.c.logging.LoggingRpcClient - ... { ... , content=CompletableRpcResponse{
    BlogPost(
      id:1, 
      title:New title, 
      content:New content., 
      createdAt:1677140636921, 
      modifiedAt:1677140636933)}}
   ```
5. Again, search for `method=getBlogPost` in the subsequent logs.
  Check that you see the blog post is updated with the new title.
  ```bash
  [armeria-common-worker-nio-2-2] DEBUG c.l.a.c.logging.LoggingRpcClient - ... { ... , content=DefaultRpcRequest{
  serviceType=BlogService$Iface, 
  serviceName=example.armeria.blog.thrift.BlogService$Iface, 
  method=getBlogPost,
  params=[GetBlogPostRequest(id:1)]}}
  ...
  [armeria-common-worker-nio-2-2] DEBUG c.l.a.c.logging.LoggingRpcClient - ... { ... , content=CompletableRpcResponse{
    BlogPost(
      id:1, 
      title:New title, 
      content:New content., 
      createdAt:1677140636921, 
      modifiedAt:1677140636933)}}
  ```

## 4. Test an error case

To check that our exception handler is working, let's try updating a post which does not exist.

1. In the `testRun()` method, call the `updateBlogPost()` method with an ID `10000`.
  ```java filename=BlogClient.java
    void testRun() throws Exception {
        ...
        updateBlogPost(10000, "New title", "New content."); // Add this
    }
  ```
2. While the server is running, run the client.
  You can see the `BlogNotFoundException` is thrown as a runtime exception.
  ```bash
  Exception in thread "main" BlogNotFoundException(reason:The blog post does not exist. ID: 10000)
        at example.armeria.blog.thrift.BlogService$updateBlogPost_result$updateBlogPost_resultStandardScheme.read(BlogService.java:3974)
        at example.armeria.blog.thrift.BlogService$updateBlogPost_result$updateBlogPost_resultStandardScheme.read(BlogService.java:3950)
        at example.armeria.blog.thrift.BlogService$updateBlogPost_result.read(BlogService.java:3888)
  ...
  ```

## What's next

Here, we've implemented a service method and client method for updating a blog post.
We've also added exception handling.
Next, we'll implement a method for [deleting a blog post](/tutorials/thrift/blog/implement-delete).

<TutorialSteps current={5} />
