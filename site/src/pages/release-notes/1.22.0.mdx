---
date: 2023-02-08
---

## üåü New features

- You can now execute asynchronous tasks in gRPC `ServerInterceptor` using `AsyncServerInterceptor`. ```java class AuthServerInterceptor implements AsyncServerInterceptor {     @Override     <I, O> CompletableFuture<Listener<I>> asyncInterceptCall(             ServerCall<I, O> call, Metadata headers, ServerCallHandler<I, O> next) {        return authorizer.authorize(headers).thenApply(result -> {             if (result) {                 return next.startCall(call, headers);             } else {                 throw new AuthenticationException("Invalid access");             }        });    } } GrpcService.builder()            .intercept(new AuthServerInterceptor()            .addService(...)            ... ``` #4647
- You can now set and see the authenticated user of a request in an access log. #4634
- Propagate `onHeaders` for gRPC client. #4583 #4608
- #4576 #4605
- Resolves one item from https://github.com/line/armeria/issues/1670 #4599
- Partially contributes to https://github.com/line/armeria/issues/2194
# Future improvements: #4599
- #4518  #4599
- #4516  #4599
- Deprecate ArmeriaSettings.ip and add ArmeriaSettings.address #4597 #4598
- Users can easily know whether a service runs on a blocking executor. #4389 #4585
- Selectively apply a blocking executor to the methods.
```java
class MyGrpcServiceImpl extends MyGrpcServiceImplBase {
    @Blocking
    public void blockingCall(...) {
        ...
    }
    public void nonBlockingCall(...) {
        ...
    }
}
@Blocking
class MyBlockingGrpcServiceImpl extends MyGrpcServiceImplBase {
    
    public void blockingCall1(...) {
        ...
    }
    public void blockingCall2(...) {
        ...
    }
}
``` #4389 #4585
- Example `schema.json` file for the `TestMessage` from `message.proto` which contains almost everything: <details> <summary>JSON Schema</summary> ```json {   "$id" : "armeria.grpc.testing.TestService/UnaryCallWithAllDifferentParameterTypes/POST",   "title" : "UnaryCallWithAllDifferentParameterTypes",   "description" : " This method's parameter message contains all different types of parameters\n as well as the response type contains all different types of parameters.\n Can be used to check any kind of serialization issues.\n",   "additionalProperties" : false,   "type" : "object",   "properties" : {     "bool" : {       "type" : "boolean",       "description" : "",       "additionalProperties" : true     },     "int32" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "int64" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "uint32" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "uint64" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "sint32" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "sint64" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "fixed32" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "fixed64" : {       "type" : "integer",       "description" : "",       "additionalProperties" : true     },     "float" : {       "type" : "number",       "description" : "",       "additionalProperties" : true     },     "double" : {       "type" : "number",       "description" : "",       "additionalProperties" : true     },     "string" : {       "type" : "string",       "description" : "",       "additionalProperties" : true     },     "bytes" : {       "type" : "string",       "description" : "",       "additionalProperties" : true     },     "test_enum" : {       "type" : "string",       "description" : "",       "enum" : [ "ZERO", "ONE", "TWO" ],       "additionalProperties" : true     },     "nested" : {       "type" : "object",       "description" : "",       "additionalProperties" : true,       "properties" : {         "string" : {           "type" : "string",           "description" : "",           "additionalProperties" : true         }       },       "required" : [ ]     },     "complex_other_message" : {       "type" : "object",       "description" : "",       "additionalProperties" : true,       "properties" : {         "bool" : {           "type" : "boolean",           "description" : "",           "additionalProperties" : true         },         "int32" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "int64" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "uint32" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "uint64" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "sint32" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "sint64" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "fixed32" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "fixed64" : {           "type" : "integer",           "description" : "",           "additionalProperties" : true         },         "float" : {           "type" : "number",           "description" : "",           "additionalProperties" : true         },         "double" : {           "type" : "number",           "description" : "",           "additionalProperties" : true         },         "string" : {           "type" : "string",           "description" : "",           "additionalProperties" : true         },         "bytes" : {           "type" : "string",           "description" : "",           "additionalProperties" : true         },         "test_enum" : {           "type" : "string",           "description" : "",           "enum" : [ "ZERO", "ONE", "TWO" ],           "additionalProperties" : true         },         "nested" : {           "type" : "object",           "description" : "",           "additionalProperties" : true,           "properties" : {             "string" : {               "type" : "string",               "description" : "",               "additionalProperties" : true             }           },           "required" : [ ]         },         "strings" : {           "type" : "array",           "description" : "",           "items" : {             "type" : "string"           }         },         "map" : {           "type" : "object",           "description" : "",           "additionalProperties" : {             "type" : "integer"           }         },         "self" : {           "$ref" : "#/properties/complex_other_message"         }       },       "required" : [ ]     },     "strings" : {       "$ref" : "#/properties/complex_other_message/properties/strings"     },     "nesteds" : {       "type" : "array",       "description" : "",       "items" : {         "$ref" : "#/properties/nested"       }     },     "selves" : {       "type" : "array",       "description" : "",       "items" : {         "$ref" : "#"       }     },     "string_to_int_map" : {       "$ref" : "#/properties/complex_other_message/properties/map"     },     "int_to_string_map" : {       "type" : "object",       "description" : "",       "additionalProperties" : {         "type" : "string"       }     },     "message_map" : {       "type" : "object",       "description" : "",       "additionalProperties" : {         "$ref" : "#/properties/nested"       }     },     "self_map" : {       "type" : "object",       "description" : "",       "additionalProperties" : {         "$ref" : "#"       }     },     "self" : {       "$ref" : "#"     },     "nested_self" : {       "type" : "object",       "description" : "",       "additionalProperties" : true,       "properties" : {         "self" : {           "$ref" : "#"         }       },       "required" : [ ]     },     "nested_nested_self" : {       "type" : "object",       "description" : "",       "additionalProperties" : true,       "properties" : {         "nested_self" : {           "$ref" : "#/properties/nested_self"         }       },       "required" : [ ]     }   },   "required" : [ ] } ``` </details> Related to #4518
- #2844  #4518
- #4516
~we might want to block this PR until #4491 is ready because this is causing extra workload on the existing doc service.~ #4518
- Add resilience4j integration for circuitbreaker #1469 #4139

## üìà Improvements

- You can now dynamically update TLS configurations with `Server.reconfigure()`. #4637
- The Thrift typedefs are correctly resolved. 
<img width="946" alt="image" src="https://user-images.githubusercontent.com/25103250/212018732-f7b4a850-8c9d-45ca-b914-fbb84618a0db.png"> #4628
- DocService front-end assets are now compressed using Gzip. #4616
- Users can support modules with different minimum java versions easily.
Note: If multiple `java(\\d+)` flags are specified, only the first one will have effect. #4593
- Resolve https://github.com/line/armeria/pull/4518#discussion_r1051738777 #4592
- An exception is raised if TLS is set to a port-based virtual host. #4588

## üõ†Ô∏è Bug fixes

- `431 Request Header Fields Too Large` is now returned instead of `400 Bad Request` if the size of headers exceeds `ServerBuilder.http1MaxHeaderSize()`. #4609 #4655
- You no longer see `NullPointerException` when an aborted `StreamMessage` is collected. #4652
- You no longer see duplicate parameters in `DocService` when parameter annotations for a request object are added to Kotlin data class. #4645
- Fix HttpJsonTranscodingService to find field descriptor with `field.getMessageType()` #4631 #4641
- Fix HttpJsonTranscodingService to accept google.protobuf.FieldMask field as string #4633 #4640
- User can access to metadata object from `StatusException` in `RequestLog.responseContent().cause()`. #4635 #4636
- You no longer see `ClosedSessionException` when a connection is closed after a response data has been fully sent in HTTP/1. #4632
- [] no longer allowed as path chars #4607 #4615
- `DecodingService` and `DecodingClient` now correctly limit the max length of decompressed streaming data. #4613

## üìÉ Documentation

- Let users know  that `@Blocking` annotation is available for gRPC services #4621

## üèöÔ∏è Deprecations

- N/A

## ‚ò¢Ô∏è Breaking changes

- N/A

## ‚õì Dependencies



Brotli test suite passes


## üóë Maybe ignore

- Typos in the documentation will be fixed. #4638
- Users facing this issue now have a successful local build.
<img width="1424" alt="Screenshot 2023-01-07 at 00 20 49" src="https://user-images.githubusercontent.com/36740791/211115813-f47c329c-47e0-4604-bc08-27224c49bdb0.png"> #4617
- Less flakiness #4590

## üôá Thank you

<ThankYou usernames={[
  'Dogacel',
  'cormoran',
  'daniel-itunu',
  'dependabot[bot]',
  'heesuk-ahn',
  'hyperxpro',
  'ikhoon',
  'j-min5u',
  'jrhee17',
  'kezhenxu94',
  'kojilin',
  'minwoox',
  'sullis',
  'ta7uw',
  'tomatophobia',
  'trustin'
]} />